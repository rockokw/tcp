Based on http://beej.us/guide/bgnet/html//index.html#a-simple-stream-server
